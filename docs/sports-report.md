# Sports Report Tool

SADIE can now generate a sports results report (NBA) and save it to your Desktop.

How it works:
- The `generate_sports_report` tool queries the configured NBA data source (ESPN endpoints) and builds a report in `HTML` or `TXT` format.
- The tool creates a folder (default: `Desktop/NBA Results`) and writes `report.html` (or `report.txt`) into that folder.

Permissions:
- Because this tool writes files, two permissions must be enabled in Settings:
  - **Write File** (`write_file`) — allows SADIE to write files to your system (disabled by default).
  - **Generate Sports Report** (`generate_sports_report`) — a tool-level permission (disabled by default).

Usage (example):
- Ask SADIE: "Create a folder on the Desktop and fill it with this week's NBA results as an HTML report." SADIE will request permission if needed.

Copy-paste ready JSON for Windows (two-step manual approach):

Step 1 — Create the folder

{
  "name": "create_directory",
  "parameters": {
    "path": "C:\\Users\\<your-username>\\Desktop\\NBA_Results"
  }
}

Step 2 — Write the report file

{
  "name": "write_file",
  "parameters": {
    "path": "C:\\Users\\<your-username>\\Desktop\\NBA_Results\\report.txt",
    "content": "This Week’s NBA Results\n\nThe Los Angeles Lakers defeated the Denver Nuggets in a strong home performance. This report is a demonstration generated by SADIE."
  }
}

Or let SADIE do it in one step using the new `generate_sports_report` tool (preferred):

{
  "name": "generate_sports_report",
  "parameters": {
    "league": "nba",
    "date": "2025-12-14",
    "directory": "Desktop/NBA Results",
    "format": "html",
    "includeSummary": true
  }
}

Notes:
- SADIE normalizes `Desktop/...` style paths to the correct platform-specific absolute path.
- SADIE performs an atomic permission precheck when multiple operations are required and will refuse the whole batch if a required permission (for example `write_file`) is disabled to avoid partial side-effects.

Permission escalation flow (Confirm + Enable):

If a requested action requires permissions that are currently disabled, SADIE will return a structured response and prompt the user to confirm. Example response from the main process:

```
{
  "status": "needs_confirmation",
  "missingPermissions": ["generate_sports_report", "write_file"],
  "reason": "This action will create folders and write files to your Desktop."
}
```

The renderer will show a clear modal explaining what will happen and where files will be written, with action buttons: **Allow once**, **Always allow**, and **Cancel**. Choosing **Allow once** will run the operation immediately; **Always allow** will enable the permissions in Settings and then run the operation.

Developer notes:
- The implementation uses existing `nba_query` tooling for fetching games and the filesystem tools for safe path validation and file writes.
- The tool defaults to the current date if no `date` is provided.

Testing:
- Unit tests are present at `widget/src/main/__tests__/sports.test.ts` and run in CI.
